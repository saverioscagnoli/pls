{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "pls configuration schema",
  "description": "schema for configuring pls",
  "type": "object",
  "properties": {
    "ls": {
      "type": "object",
      "description": "configuration for the list command output",
      "properties": {
        "format": {
          "type": "array",
          "description": "array of template strings. it is what defines the output of the command",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "padding": {
          "type": "number",
          "description": "the spacing between colums, think of it as the space between the format array strings",
          "minimum": 0
        },
        "style": {
          "type": "object",
          "description": "configuration for per-variable style",
          "properties": {
            "name": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "path": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "kind": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "size": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "icon": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "permissions": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "created": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "modified": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "accessed": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "owner": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            },
            "group": {
              "oneOf": [
                { "$ref": "#/definitions/variableStyle" },
                { "$ref": "#/definitions/conditionalStyle" }
              ]
            }
          }
        }
      }
    }
  },
  "definitions": {
    "color": {
      "oneOf": [
        {
          "type": "string",
          "description": "Color name or code",
          "enum": [
            "black",
            "red",
            "green",
            "yellow",
            "blue",
            "magenta",
            "cyan",
            "white",
            "gray",
            "bright black",
            "bright red",
            "bright green",
            "bright yellow",
            "bright blue",
            "bright magenta",
            "bright cyan",
            "bright white"
          ]
        },
        {
          "type": "integer",
          "description": "ansi color code",
          "minimum": 0,
          "maximum": 255
        },
        {
          "type": "array",
          "description": "RGB color as [r, g, b]",
          "items": {
            "type": "integer",
            "minimum": 0,
            "maximum": 255
          },
          "minItems": 3,
          "maxItems": 3
        }
      ]
    },
    "text": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "bold",
          "italic",
          "underline",
          "strikethrough",
          "blink",
          "inverse",
          "conceal",
          "overline",
          "double_underline"
        ]
      }
    },
    "variableStyle": {
      "type": "object",
      "description": "Style for variables",
      "properties": {
        "foreground": {
          "$ref": "#/definitions/color"
        },
        "background": {
          "$ref": "#/definitions/color"
        },
        "text": {
          "$ref": "#/definitions/text"
        }
      }
    },
    "conditionOperator": {
      "type": "string",
      "enum": [
        "eq",
        "neq",
        "lt",
        "lte",
        "gt",
        "gte",
        "regex",
        "contains",
        "in",
        "exists"
      ],
      "description": "Operator used to compare a metadata field with a value"
    },
    "conditionValue": {
      "oneOf": [
        { "type": "string" },
        { "type": "number" },
        { "type": "boolean" },
        { "type": "array", "items": {} }
      ]
    },
    "condition": {
      "type": "object",
      "description": "A condition to match against file metadata",
      "required": ["field", "op"],
      "properties": {
        "field": {
          "type": "string",
          "description": "Metadata field to test, e.g. 'name','kind','size','extension','owner','group','permissions','created','modified','accessed'"
        },
        "op": { "$ref": "#/definitions/conditionOperator" },
        "value": { "$ref": "#/definitions/conditionValue" }
      },
      "additionalProperties": false
    },
    "conditionalRule": {
      "type": "object",
      "required": ["when", "style"],
      "properties": {
        "when": {
          "oneOf": [
            { "$ref": "#/definitions/condition" },
            {
              "type": "array",
              "items": { "$ref": "#/definitions/condition" },
              "minItems": 1
            }
          ]
        },
        "style": { "$ref": "#/definitions/variableStyle" }
      },
      "additionalProperties": false
    },
    "conditionalStyle": {
      "type": "object",
      "description": "Either a default style plus ordered rules, or just rules. Rules are evaluated in order; first match wins.",
      "properties": {
        "default": { "$ref": "#/definitions/variableStyle" },
        "rules": {
          "type": "array",
          "items": { "$ref": "#/definitions/conditionalRule" },
          "minItems": 1
        }
      },
      "additionalProperties": false
    }
  }
}
